import{r as o,g as L,j as s,d as k,a as D,b}from"./index-DaKuGouW.js";import{L as $}from"./Loading-CUdY1bcp.js";const q=()=>{const[C,y]=o.useState([]),[N,x]=o.useState(!0),[l,n]=o.useState(null),[t,E]=o.useState("pending"),[S,h]=o.useState(null),[g,u]=o.useState(""),[f,r]=o.useState("");o.useEffect(()=>{d()},[]);const d=async()=>{try{console.log("ðŸ“¥ Cargando pedidos..."),x(!0);const e=await L();y(e)}catch(e){console.error("Error al cargar pedidos:",e),alert("Error al cargar los pedidos")}finally{x(!1)}},v=async e=>{if(e){n(e),console.log(`âœ… Completando pedido ${e}`);try{await b(e,"completed"),await d(),r("âœ… Pedido completado exitosamente"),setTimeout(()=>r(""),3e3)}catch(a){console.error("Error al completar pedido:",a),alert("Error al completar el pedido")}finally{n(null)}}},A=async e=>{if(e&&confirm("Â¿EstÃ¡s seguro de cancelar este pedido?")){n(e),console.log(`âŒ Cancelando pedido ${e}`);try{await b(e,"cancelled"),await d(),r("âŒ Pedido cancelado exitosamente"),setTimeout(()=>r(""),3e3)}catch(a){console.error("Error al cancelar pedido:",a),alert("Error al cancelar el pedido")}finally{n(null)}}},O=async()=>{const e=p(t);if(e.length===0){alert("No hay pedidos para eliminar");return}if(confirm(`Â¿EstÃ¡s seguro de que deseas eliminar todos los ${e.length} pedidos ${i[t].label.toLowerCase()}? Esta acciÃ³n no se puede deshacer.`)){n("deleting-all"),console.log(`ðŸ—‘ï¸ Eliminando todos los pedidos ${t}`);try{for(const a of e)a.id&&await k(a.id);console.log("âœ… Todos los pedidos fueron eliminados"),await d(),r(`ðŸ—‘ï¸ ${e.length} pedidos eliminados exitosamente`),setTimeout(()=>r(""),3e3)}catch(a){console.error("Error al eliminar pedidos:",a),alert("Error al eliminar los pedidos")}finally{n(null)}}},p=e=>C.filter(a=>a.status===e),i={pending:{label:"â³ Pendientes",color:"#ff9800"},completed:{label:"âœ… Completados",color:"#4caf50"},cancelled:{label:"âŒ Cancelados",color:"#f44336"}},c=p(t);if(N)return s.jsx($,{message:"Cargando pedidos..."});const w=e=>{e.id&&(h(e.id),u(e.customerAddress))},j=()=>{h(null),u("")},T=async e=>{if(!e)return;const a=g.trim();if(!a){alert("La direcciÃ³n no puede estar vacÃ­a");return}n(e);try{await D(e,a),await d(),j(),r("âœ… DirecciÃ³n actualizada exitosamente"),setTimeout(()=>r(""),3e3)}catch(m){console.error("Error al actualizar direcciÃ³n:",m),alert("Error al actualizar la direcciÃ³n")}finally{n(null)}};return s.jsxs("div",{className:"pendingOrders",children:[f&&s.jsx("div",{style:z,children:f}),s.jsx("h2",{className:"ordersTitle",children:"ðŸ“‹ GestiÃ³n de Pedidos"}),s.jsx("div",{className:"statusTabs",children:Object.keys(i).map(e=>s.jsxs("button",{className:`statusTab ${t===e?"active":""}`,onClick:()=>E(e),children:[i[e].label,s.jsx("span",{className:"tabCount",children:p(e).length})]},e))}),(t==="completed"||t==="cancelled")&&c.length>0&&s.jsx("button",{className:"btnDeleteAll",onClick:O,disabled:l==="deleting-all",children:l==="deleting-all"?"ðŸ—‘ï¸ Eliminando...":`ðŸ—‘ï¸ Borrar todos (${c.length})`}),c.length===0?s.jsxs("p",{style:{textAlign:"center",color:"#999",fontSize:"18px"},children:["No hay pedidos en estado"," ",i[t].label.toLowerCase()]}):s.jsx("ul",{className:"ordersList",children:c.map(e=>s.jsxs("li",{className:"orderItem",children:[s.jsxs("div",{className:"orderHeader",children:[s.jsxs("div",{children:[s.jsxs("span",{className:"orderId",children:["Pedido #",e.id?.slice(-6).toUpperCase()]}),s.jsxs("p",{className:"customerInfo",children:["ðŸ‘¤ ",e.customerName,s.jsx("br",{}),S===e.id?s.jsxs(s.Fragment,{children:["ðŸ“"," ",s.jsx("input",{type:"text",value:g,onChange:a=>u(a.target.value)}),s.jsx("button",{className:"btnComplete",onClick:()=>T(e.id),disabled:l===e.id,children:l===e.id?"...":"âœ“ Guardar"}),s.jsx("button",{className:"btnCancel",onClick:j,children:"âœ• Cancelar"})]}):s.jsxs(s.Fragment,{children:["ðŸ“ ",e.customerAddress,t==="pending"&&s.jsx("button",{className:"btnEdit",onClick:()=>w(e),children:"âœï¸"})]})]})]}),s.jsxs("div",{className:"orderDate",children:[e.createdAt.toLocaleDateString("es-ES"),s.jsx("br",{}),e.createdAt.toLocaleTimeString("es-ES")]})]}),s.jsx("div",{className:"orderItems",children:e.items.map((a,m)=>s.jsxs("div",{className:"orderItemDetail",children:[s.jsxs("span",{children:[a.quantity,"x ",a.name]}),s.jsxs("span",{children:[a.price.toFixed(2),"â‚¬"]}),s.jsxs("span",{children:[(a.price*a.quantity).toFixed(2),"â‚¬"]})]},m))}),s.jsx("div",{className:"orderTotal",children:s.jsxs("strong",{children:["Total: ",e.total.toFixed(2),"â‚¬"]})}),s.jsxs("div",{className:"orderActions",children:[s.jsx("span",{className:`orderStatus ${t}`,style:{backgroundColor:i[t].color},children:i[t].label}),t==="pending"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btnComplete",onClick:()=>v(e.id),disabled:l===e.id,children:l===e.id?"...":"âœ“ Completar"}),s.jsx("button",{className:"btnCancel",onClick:()=>A(e.id),disabled:l===e.id,children:l===e.id?"...":"âœ• Cancelar"})]})]})]},e.id))})]})},z={position:"fixed",top:"20px",right:"20px",background:"#27ae60",color:"white",padding:"15px 25px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",zIndex:1e4,fontSize:"16px",fontWeight:"bold"};export{q as default};
